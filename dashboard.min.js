/*
	Dashboard version 0.10.1 alpha
	(c) 2016 Epistemex
	www.epistemex.com
	MIT License
*/
function Dashboard(G){G=G||{};var E=this,I=D(G.idPrefix)?G.idPrefix+"_":"",e=0,N=G.tabIndexStart||1,c=G.callback,x=document,k=x.createElement.bind(x),y=x.getElementById.bind(x),w=i(),F=G.parent,H=F?(D(F)?y(F):F):x.body,z="pointer-events: none !important",O;w.className=G.css||"dashboard";if(G.id){w.id=G.id}b(H,w);function b(R){for(var Q=1,P=arguments;Q<P.length;Q++){R.appendChild(P[Q])}}function L(R,P,Q){if(P.cb){R.__cb=P.cb.bind(Q)}}function J(Q,S,P,R){Q.dataset.type=S;if(!R){Q.tabIndex=N++}if(P.bind){Q.dataset.bind=P.bind}}function K(P){return P.parentNode.querySelectorAll("input")}function M(P,R,Q){if(!Q){P.value=R}P.__v.innerHTML=P.__tr?P.__tr(P.value):P.value}function B(P){return typeof P==="boolean"}function D(P){return typeof P==="string"}function C(P){return typeof P!=="undefined"}function s(P,U,T,Z,X,S,Y){var R=q(P),Q=p(P),V=o(P,"range"),W=k("span");W.id=P.id+"v";V.min=U;V.max=T;V.step=X;V.value=Math.max(U,Math.min(T,Z));V.disabled=P.dis;V.__v=W;V.__tr=Y;J(V,"slider",P);L(V,P,R);M(V,Z,!0);if(S){V.oninput=d}else{V.onchange=d;V.oninput=A}b(R,Q,V,W);return R}function g(P,R){var T=q(P),S=p(P),Q=o(P,"checkbox");Q.checked=R;Q.disabled=P.dis;Q.onchange=d;J(Q,"checkbox",P);L(Q,P,T);b(T,S,Q);return T}function u(P,U,S,T){var R=q(P),Q=p(P),V=o(P,"text");V.value=U;V.disabled=P.dis;V.onchange=d;J(V,"textbox",P);L(V,P,R);if(T){V.placeholder=T}if(S){V.onkeyup=d}if(P.cb){V.__cb=P.cb.bind(R)}b(R,Q,V);return R}function n(P,T){var S=q(P),R=p(P),Q=k("i");Q.id=P.id;Q.innerHTML=T;Q.disabled=P.dis;J(Q,"info",P,!0);b(S,R,Q);return S}function t(P,S,Q){var T=q(P),R;if(Q){T.innerHTML=S||""}else{R=k("p");R.innerHTML=S||"";R.id=P.id;b(T,R)}return T}function h(P,R){var T=q(P),S=p(P),Q=o(P,"color");S.style.cssText=z;Q.value=R;Q.disabled=P.dis;Q.onchange=d;J(Q,"color",P);L(Q,P,T);b(T,S,Q);return T}function j(P,T,V){var S=q(P),R=p(P),U=k("select"),Q=0;U.id=P.id;U.disabled=P.dis;U.onchange=d;J(U,"dropdown",P);L(U,P,S);T.forEach(function(W){var X=k("option");X.innerHTML=W;if(Q++===V){X.selected="selected"}b(U,X)});b(S,R,U);return S}function r(P,Q,U,V){var T=q(P),S=i(),R=0;S.id=P.id;S.innerHTML="<p>"+P.lbl+"</p>";S.className="radio";J(S,"radio",P,!0);b(T,S);U.forEach(function(Y){var W={lbl:Y,id:P.id+"_"+R,cb:P.cb},X=i(),aa=o(W,"radio"),Z=p(W);X.className="radio";aa.name=Q;aa.id=W.id;aa.value=Y;aa.onclick=d;aa.disabled=P.dis;J(aa,"radio",P);L(aa,W,aa);if(R++===V){aa.checked="checked"}b(X,aa,Z);b(T,X)});return T}function f(P,R){var T=q(P),S=p(P),Q=k("button");S.style.cssText=z;Q.id=P.id;Q.innerHTML=R;Q.disabled=P.dis;Q.onclick=d;J(Q,"button",P);L(Q,P,T);b(T,S,Q);return T}function m(P,S){var R=q(P),Q=new Image;Q.id=P.id;Q.src=S;Q.disabled=P.dis;J(Q,"image",P,!0);b(R,Q);return R}function l(P,U,R){var T=q(P),S=i(),Q=d.bind(S);T.className=R?"hidden":P.css||"group";T.disabled=P.dis;S.id=P.id;S.innerHTML=P.lbl;S.onclick=function(){if(this.disabled){return}T.className=this.__state?P.css||"group":"hidden";this.__state=!this.__state;Q()};S.onkeydown=function(V){var W=V.keyCode;if(W===37||W===39){this.__state=W===39}if([13,32,37,39].indexOf(W)>-1){V.preventDefault();this.dispatchEvent(new MouseEvent("click"))}};S.__state=R;J(S,"group",P);L(S,P,T);b(T,S);U.forEach(function(V){E.add(V,T)});return T}function a(P,S){var R=q(P),Q=S.control;Q.id=P.id;Q.__ecb=(S.onEnable||function(){}).bind(Q);Q.__set=(S.onSet||function(){}).bind(Q);Q.__get=(S.onGet||function(){}).bind(Q);J(Q,"custom",P,!0);b(R,Q);L(Q,P,R);return R}function i(){return k("div")}function q(P){var Q=i();Q.className=P.css||"line";if(!P.show){Q.style.display="none"}return Q}function o(P,R){var Q=k("input");Q.id=P.id;Q.type=R;return Q}function p(P){var Q=k("label");Q.setAttribute("for",P.id);Q.innerHTML=P.lbl;return Q}function d(){var Q=this,P=Q.__cb;if(Q.__v){M(Q,Q.value,!0)}if(P){var U=E.value(Q),T=Q.dataset.type,S=T==="radio";if(Q.__old!==U||T==="button"){clearTimeout(O);var R=Q.id.substr(I.length);if(S){R=R.substr(0,R.lastIndexOf("_"))}O=setTimeout(P({id:R,target:Q,type:Q.dataset.type,value:U,timestamp:Date.now()}),7);if(!S){Q.__old=U}}}}function A(){M(this,this.value,!0)}function v(P){(d.bind(P))()}this.add=function(S,T){function Q(U){if(D(U)){U=y(I+U)||y(U);if(U.dataset.type&&U.dataset.type==="group"){U=U.parentNode}}return U}if(Array.isArray(S)){var R=this;S.forEach(function(U){R.add(U,T)})}else{e++;b(Q(T||S.parent||w),P({id:I+(S.id||S.type+e),dis:!(B(S.enabled)?S.enabled:!0),css:S.css,show:B(S.show)?S.show:!0,lbl:S.label||(S.type+e),cb:S.callback||c,bind:S.bind}))}function P(U){var V,X=C(S.value)?S.value:0,W=S.text||"";switch(S.type){case"group":return l(U,S.items||[],S.collapsed);case"slider":if(Array.isArray(V=S.items)){return s(U,0,V.length-1,0,1,S.live,function(Y){return V[Y]})}else{return s(U,S.min||0,C(S.max)?S.max:100,X,S.step||1,S.live,S.formatter)}case"checkbox":return g(U,S.checked);case"textbox":return u(U,W,S.live,S.placeholder);case"color":return h(U,S.color||"#ff0000");case"dropdown":return j(U,S.items,X);case"radio":return r(U,S.group||"radiogrp_"+e,S.items,X);case"button":return f(U,S.text||S.type+e);case"separator":return k("hr");case"info":return n(U,W);case"text":return t(U,W,S.raw);case"image":return m(U,S.url);case"custom":return a(U,S);default:throw"Unknown type"}}return this};this.remove=function(P){var Q=D(P)?y(I+P):P,R;if(!Q||!Q.dataset.type){throw"Unknown control"}R=Q.parentNode;R.parentNode.removeChild(R);return this};this.value=function(Q,W){var S=D(Q)?y(I+Q):Q,U,T,P,R,V=S.dataset.type;if(S&&V){if(arguments.length===2){switch(V){case"slider":M(S,W);break;case"checkbox":S.checked=W;break;case"image":S.src=W;break;case"group":S.__state=W;S.dispatchEvent(new MouseEvent("click"));break;case"color":case"textbox":case"radio":U=K(S);if(D(W)){for(P=0;P<U.length;P++){if(U[P].value===W){U[P].checked="checked";break}}}else{U[W].checked="checked"}break;case"info":case"button":S.innerHTML=W;break;case"custom":S.__set(W);break;case"dropdown":if(typeof W==="number"){if(W>=0&&W<S.options.length){S.selectedIndex=W}}else{if(typeof W==="string"){for(P=0,T=S.options,R=T.length;P<R;P++){if(T[P].innerHTML===W){S.selectedIndex=P;break}}}}break}return this}else{switch(V){case"slider":return +S.value;case"checkbox":return !!S.checked;case"image":return S.src;case"group":return !S.__state;case"color":case"textbox":return S.value;case"radio":U=K(S.type?S.parentNode:S);for(P=0;P<U.length;P++){if(U[P].checked){return P}}return -1;case"info":case"button":return S.innerHTML;case"custom":return S.__get();case"dropdown":return S.selectedIndex}}}};this.enable=function(Q,T){var R=D(Q)?y(I+Q):Q,U=R.dataset.type,S,P;if(R&&U){if(!T&&U==="group"){this.value(Q,!1)}else{if(U==="radio"){S=K(R);for(P=0;P<S.length;P++){S[P].disabled=!T}}else{if(U==="custom"){if(R.__ecb){R.__ecb(T)}}else{R.disabled=!T}}}}return this};this.show=function(P,R){if(arguments.length===1){w.style.display=P?null:"none"}else{var Q=D(P)?y(I+P):P;if(Q&&Q.dataset.type){Q.parentNode.style.display=R?null:"none"}}return this};this.bindTo=function(S){if(D(S)){S=JSON.parse(S)}var Q=w.querySelectorAll("*"),P,R=0,U;while(P=Q[R++]){if(P.dataset.bind&&C(S[P.dataset.bind])){if(P.dataset.type==="radio"){var T=K(P),V=S[P.dataset.bind];for(U=0;U<T.length;U++){if(T[U].value===V){T[U].checked="checked";break}}}else{this.value(P,S[P.dataset.bind])}}}};this.getBound=function(){var S={},P,R=0,Q=w.querySelectorAll("*");while(P=Q[R++]){if(D(P.dataset.bind)){if(P.dataset.type==="radio"){var T=K(P);for(var U=0;U<T.length;U++){if(T[U].checked){S[P.dataset.bind]=T[U].value;break}}}else{S[P.dataset.bind]=this.value(P)}}}return S};this.getCallback=function(){return v}};