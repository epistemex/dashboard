/*
	Dashboard version 0.8.0 alpha
	(c) 2016 Epistemex
	www.epistemex.com
	MIT License
*/
function Dashboard(F){F=F||{};var D=this,H=C(F.idPrefix)?F.idPrefix+"_":"",d=0,M=F.tabIndexStart||1,b=F.callback,w=document,j=w.createElement.bind(w),x=w.getElementById.bind(w),v=h(),E=F.parent,G=E?(C(E)?x(E):E):w.body,y="pointer-events: none !important",N;v.className=F.css||"dashboard";if(F.id){v.id=F.id}a(G,v);function a(Q){for(var P=1,O=arguments;P<O.length;P++){Q.appendChild(O[P])}}function K(Q,O,P){if(O.cb){Q.__cb=O.cb.bind(P)}}function I(P,R,O,Q){P.dataset.type=R;if(!Q){P.tabIndex=M++}if(O.bind){P.dataset.bind=O.bind}}function J(O){return O.parentNode.querySelectorAll("input")}function L(O,Q,P){if(!P){O.value=Q}O.__v.innerHTML=O.__tr?O.__tr(O.value):O.value}function A(O){return typeof O==="boolean"}function C(O){return typeof O==="string"}function B(O){return typeof O!=="undefined"}function r(O,T,S,Y,W,R,X){var Q=p(O),P=o(O),U=n(O,"range"),V=s(O,0);U.min=T;U.max=S;U.step=W;U.value=Math.max(T,Math.min(S,Y));U.disabled=O.dis;U.__v=V;U.__tr=X;I(U,"slider",O);K(U,O,Q);L(U,Y,!0);if(R){U.oninput=c}else{U.onchange=c;U.oninput=z}a(Q,P,U,V);return Q}function f(O,Q){var S=p(O),R=o(O),P=n(O,"checkbox");P.checked=Q;P.disabled=O.dis;P.onchange=c;I(P,"checkbox",O);K(P,O,S);a(S,R,P);return S}function u(O,T,R,S){var Q=p(O),P=o(O),U=n(O,"text");U.value=T;U.disabled=O.dis;U.onchange=c;I(U,"textbox",O);K(U,O,Q);if(S){U.placeholder=S}if(R){U.onkeyup=c}if(O.cb){U.__cb=O.cb.bind(Q)}a(Q,P,U);return Q}function m(O,S){var R=p(O),Q=o(O),P=j("i");P.id=O.id;P.innerHTML=S;P.disabled=O.dis;I(P,"info",O,!0);a(R,Q,P);return R}function t(O,R,P){var S=p(O),Q;if(P){S.innerHTML=R||""}else{Q=j("p");Q.innerHTML=R||"";Q.id=O.id;a(S,Q)}return S}function g(O,Q){var S=p(O),R=o(O),P=n(O,"color");R.style.cssText=y;P.value=Q;P.disabled=O.dis;P.onchange=c;I(P,"color",O);K(P,O,S);a(S,R,P);return S}function i(O,S,U){var R=p(O),Q=o(O),T=j("select"),P=0;T.id=O.id;T.disabled=O.dis;T.onchange=c;I(T,"dropdown",O);K(T,O,R);S.forEach(function(V){var W=j("option");W.innerHTML=V;if(P++===U){W.selected="selected"}a(T,W)});a(R,Q,T);return R}function q(O,P,T,U){var S=p(O),R=h(),Q=0;R.id=O.id;R.innerHTML="<p>"+O.lbl+"</p>";R.className="radio";I(R,"radio",O,!0);a(S,R);T.forEach(function(X){var V={lbl:X,id:O.id+"_"+Q,cb:O.cb},W=h(),Z=n(V,"radio"),Y=o(V);W.className="radio";Z.name=P;Z.id=V.id;Z.value=X;Z.onclick=c;Z.disabled=O.dis;I(Z,"radio",O);K(Z,V,Z);if(Q++===U){Z.checked="checked"}a(W,Z,Y);a(S,W)});return S}function e(O,Q){var S=p(O),R=o(O),P=j("button");R.style.cssText=y;P.id=O.id;P.innerHTML=Q;P.disabled=O.dis;P.onclick=c;I(P,"button",O);K(P,O,S);a(S,R,P);return S}function l(O,R){var Q=p(O),P=new Image;P.id=O.id;P.src=R;P.disabled=O.dis;I(P,"image",O,!0);a(Q,P);return Q}function k(O,T,Q){var S=p(O),R=h(),P=c.bind(R);S.className=Q?"hidden":O.css||"group";S.disabled=O.dis;R.id=O.id;R.innerHTML=O.lbl;R.onclick=function(){if(this.disabled){return}S.className=this.__state?O.css||"group":"hidden";this.__state=!this.__state;P()};R.onkeydown=function(U){var V=U.keyCode;if(V===37||V===39){this.__state=V===39}if([13,32,37,39].indexOf(V)>-1){U.preventDefault();this.dispatchEvent(new MouseEvent("click"))}};R.__state=Q;I(R,"group",O);K(R,O,S);a(S,R);T.forEach(function(U){D.add(U,S)});return S}function h(){return j("div")}function p(O){var P=h();P.className=O.css||"line";if(!O.show){P.style.display="none"}return P}function s(O,Q){var P=j("span");P.id=O.id+"v";P.innerHTML=Q;return P}function n(O,Q){var P=j("input");P.id=O.id;P.type=Q;return P}function o(O){var P=j("label");P.setAttribute("for",O.id);P.innerHTML=O.lbl;return P}function c(){var P=this,O=P.__cb;if(P.__v){L(P,P.value,!0)}if(O){var T=D.value(P),S=P.dataset.type,R=S==="radio";if(P.__old!==T||S==="button"){clearTimeout(N);var Q=P.id.substr(H.length);if(R){Q=Q.substr(0,Q.lastIndexOf("_"))}N=setTimeout(O({id:Q,target:P,type:P.dataset.type,value:T,timestamp:Date.now()}),7);if(!R){P.__old=T}}}}function z(){L(this,this.value,!0)}this.add=function(Q,R){if(Array.isArray(Q)){var P=this;Q.forEach(function(S){P.add(S,R)})}else{d++;a(R||v,O({id:H+(Q.id||Q.type+d),dis:!(A(Q.enabled)?Q.enabled:!0),css:Q.css,show:A(Q.show)?Q.show:!0,lbl:Q.label||(Q.type+d),cb:Q.callback||b,bind:Q.bind}))}function O(S){var T,V=B(Q.value)?Q.value:0,U=Q.text||"";switch(Q.type){case"group":return k(S,Q.items||[],Q.collapsed);case"slider":if(Array.isArray(T=Q.items)){return r(S,0,T.length-1,0,1,Q.live,function(W){return T[W]})}else{return r(S,Q.min||0,B(Q.max)?Q.max:100,V,Q.step||1,Q.live,Q.formatter)}case"checkbox":return f(S,Q.checked);case"textbox":return u(S,U,Q.live,Q.placeholder);case"color":return g(S,Q.color||"#ff0000");case"dropdown":return i(S,Q.items,V);case"radio":return q(S,Q.group||"radiogrp_"+d,Q.items,V);case"button":return e(S,Q.text||Q.type+d);case"separator":return j("hr");case"info":return m(S,U);case"text":return t(S,U,Q.raw);case"image":return l(S,Q.url);default:throw"Unknown type"}}return this};this.rem=function(O){var P=C(O)?x(H+O):O,Q;if(!P||!P.dataset.type){throw"Unknown control"}Q=P.parentNode;Q.parentNode.removeChild(Q);return this};this.value=function(P,U){var R=C(P)?x(H+P):P,T,S,O,Q;if(R&&R.dataset.type){if(arguments.length===2){switch(R.dataset.type){case"slider":L(R,U);break;case"checkbox":R.checked=U;break;case"image":R.src=U;break;case"group":R.__state=U;R.dispatchEvent(new MouseEvent("click"));break;case"color":case"textbox":case"radio":T=J(R);if(C(U)){for(O=0;O<T.length;O++){if(T[O].value===U){T[O].checked="checked";break}}}else{T[U].checked="checked"}break;case"info":case"button":R.innerHTML=U;break;case"dropdown":if(typeof U==="number"){if(U>=0&&U<R.options.length){R.selectedIndex=U}}else{if(typeof U==="string"){for(O=0,S=R.options,Q=S.length;O<Q;O++){if(S[O].innerHTML===U){R.selectedIndex=O;break}}}}break}return this}else{switch(R.dataset.type){case"slider":return +R.value;case"checkbox":return !!R.checked;case"image":return R.src;case"group":return !R.__state;case"color":case"textbox":return R.value;case"radio":T=J(R.type?R.parentNode:R);for(O=0;O<T.length;O++){if(T[O].checked){return O}}return -1;case"info":case"button":return R.innerHTML;case"dropdown":return R.selectedIndex}}}};this.enable=function(P,S){var Q=C(P)?x(H+P):P,R,O;if(Q&&Q.dataset.type){if(!S&&Q.dataset.type==="group"){this.value(P,!1)}if(Q.dataset.type==="radio"){R=J(Q);for(O=0;O<R.length;O++){R[O].disabled=!S}}else{Q.disabled=!S}}return this};this.show=function(O,Q){if(arguments.length===1){v.style.display=O?null:"none"}else{var P=C(O)?x(H+O):O;if(P&&P.dataset.type){P.parentNode.style.display=Q?null:"none"}}return this};this.bindTo=function(R){if(C(R)){R=JSON.parse(R)}var P=v.querySelectorAll("*"),O,Q=0,T;while(O=P[Q++]){if(O.dataset.bind&&B(R[O.dataset.bind])){if(O.dataset.type==="radio"){var S=J(O),U=R[O.dataset.bind];for(T=0;T<S.length;T++){if(S[T].value===U){S[T].checked="checked";break}}}else{this.value(O,R[O.dataset.bind])}}}};this.getBound=function(){var R={},O,Q=0,P=v.querySelectorAll("*");while(O=P[Q++]){if(C(O.dataset.bind)){if(O.dataset.type==="radio"){var S=J(O);for(var T=0;T<S.length;T++){if(S[T].checked){R[O.dataset.bind]=S[T].value;break}}}else{R[O.dataset.bind]=this.value(O)}}}return R}};